#!/usr/bin/env python

import sysman.client,sysman.confhandler
import socket,re,cPickle

servername = socket.gethostname()
serverport = 61874
if servername == 'Giove':
    systems = sysman.confhandler.Configuration('/home/fabrizio/APPO/bck/sysmand.xml.save')
elif servername == 'D03':
    systems = sysman.confhandler.Configuration('/home/frosa/APPO/bck/sysmand.xml.save')
    systems.load_conf()
ucraina = systems.get_system('Ucraina')

print 'Starting connection to server ' + servername + ' at port ' + str(serverport)
print 'Type \'help\' for command list. Type \'quit\' to end session'

def io():
    while True:
        comm = str(raw_input('@> '))
        if comm == 'quit':
            break
        match = re.match('^(.+):(.+)$',comm)
        if not match:
            comm = comm + ':nop'
        info = re.sub('[\n\r]','',connection.query(comm))
        print info
    print 'Bye!'
    
connection = sysman.client.Client(servername,serverport)
io()
pkucraina = cPickle.dumps(ucraina)
#print pkucraina
info = re.sub('[\n\r]','',connection.query('set_conf:%s\n*DONE\n' % pkucraina))
print info
io()
connection.socket().close()